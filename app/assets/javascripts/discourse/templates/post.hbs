{{post-gap post=this postStream=controller.model.postStream before="true"}}

{{#if hasTimeGap}}
  {{time-gap daysAgo=daysSincePrevious postStream=controller.model.postStream}}
{{/if}}

<div class='row'>
  {{view 'reply-history' content=replyHistory}}
</div>

    <div class='topic-body'>
      <div class="select-posts {{unless controller.multiSelect 'hidden'}}">
        <button {{action "toggledSelectedPostReplies" this}} class="{{unless view.canSelectReplies 'hidden'}}">{{i18n 'topic.multi_select.select_replies'}}</button>
        <button {{action "toggledSelectedPost" this}} class="select-post">{{view.selectPostText}}</button>
      </div>

      <!-- keep the classes here in sync with composer.hbs -->
      <div {{bind-attr class="showUserReplyTab:avoid-tab view.repliesShown::contents"}}>
        <div class='cooked'>
          {{{cooked}}}
          {{plugin-outlet "post-after-cooked"}}
          {{#if firstPost}}
            {{plugin-outlet "topic-after-cooked"}}
          {{/if}}
        </div>
        {{#if cooked_hidden}}
          <a href {{action "expandHidden" this}}>{{i18n 'post.show_hidden'}}</a>
        {{/if}}
        {{#if view.showExpandButton}}
          {{#if controller.loadingExpanded}}
            <button class="btn expand-post" disabled>{{i18n 'loading'}}</button>
          {{else}}
            <button {{action "expandFirstPost" this}} class='btn expand-post'>{{i18n 'post.show_full'}}&hellip;</button>
          {{/if}}
        {{/if}}
      </div>

      {{#if replies}}
        <section class='embedded-posts bottom'>
          {{#each reply in replies}}
            {{view 'embedded-post' content=reply}}
          {{/each}}
        </section>
      {{/if}}

      {{view 'topic-map-container' post=this topic=controller.model}}
    </div>

    {{post-gutter post=this
                  links=internalLinks
                  canReplyAsNewTopic=topic.details.can_reply_as_new_topic
                  newTopicAction="replyAsNewTopic"}}

{{post-gap post=this postStream=controller.model.postStream before="false"}}
{{plugin-outlet "post-bottom"}}
